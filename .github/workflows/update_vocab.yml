# .github/workflows/update_vocab.yml

name: Sync Firebase Vocab to JSON

on:
  # Trigger manually for testing
  workflow_dispatch:
  # Schedule to run every day at 00:00 UTC
  schedule:
    - cron: '0 0 * * *' 
  # Run whenever the sync script is modified
  push:
    paths:
      - 'sync-vocab.js'

jobs:
  sync:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write # This grants the necessary permission to commit and push files    
      
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      # We need firebase-admin to talk to Firestore
      run: npm install firebase-admin
      
    - name: Run vocab sync script
      run: node sync-vocab.js
      env:
        # Pass the secret key as an environment variable to the script
        FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
        
    - name: Commit and Push changes
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "ðŸ¤– chore(data): Auto-sync vocabulary data from Firebase"
        # âœ… CORRECT INPUT: 'file_pattern'
        file_pattern: | 
          vocab_data/*.json
